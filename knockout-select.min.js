define(["require","exports","knockout"],function(a,b,c){var d;!function(a){function b(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function d(a,b){return b&&a.optionsText&&"string"==typeof a.optionsText?c.unwrap(c.unwrap(b)[a.optionsText]):a.optionsText&&"function"==typeof a.optionsText?a.optionsText(c.unwrap(c.unwrap(b))):c.unwrap(b)}function e(a,b){return a.optionsValue&&"string"==typeof a.optionsValue?c.unwrap(c.unwrap(b)[a.optionsValue]):a.optionsValue&&"function"==typeof a.optionsValue?a.optionsValue(c.unwrap(c.unwrap(b))):c.unwrap(b)}function f(a,b){b.classList.add(M),b.classList.add(N),a.classList.add(M),a.classList.add(O),a.style.minWidth=b.offsetWidth+"px",a.style.width="auto",a.style.position="absolute",a.style.overflow="auto",a.style.zIndex=T.toString()}function g(a){a.captionElement=document.createElement("button"),a.captionText=document.createElement("span"),a.captionElement.appendChild(a.captionText);var b=document.createElement("span");b.classList.add(P),a.captionElement.appendChild(b),a.captionText.textContent=c.unwrap(a.optionsCaption),a.captionElement.setAttribute("data-open",(!1).toString()),a.element.getAttribute("tabindex")&&(a.captionElement.setAttribute("tabindex",a.element.getAttribute("tabindex")),a.element.removeAttribute("tabindex"))}function h(a,c){var e=document.createElement("div");e.textContent=d(c,a),e.setAttribute("data-selected",(!1).toString()),e.classList.add(Q),e.onmouseover=q(c),e.onclick=y(c);var f=-1,g=new X(-1,-1);return e.ontouchstart=function(a){return 1===a.touches.length?(g.x=a.touches[0].pageX,g.y=a.touches[0].pageY,f=a.timeStamp||(new Date).getTime(),a.stopPropagation(),q(c)(a)):(c.hoverIndex(-1),!0)},e.ontouchend=function(a){if(0===a.touches.length&&1===a.changedTouches.length){var d=new X(a.changedTouches[0].pageX,a.changedTouches[0].pageY),e=b(g,d),h=a.timeStamp||(new Date).getTime();if(1e3>h-f&&10>e)return a.stopPropagation(),y(c)()}return c.hoverIndex(-1),!0},e}function i(a,b,d){for(var f=0;f<a.length;f++)if(e(d,a[f])===c.unwrap(b))return a[f];return void 0}function j(a,b,d){c.unwrap(a.selectedOptions).indexOf(e(a,b))>=0?(d.classList.add(R),d.setAttribute("data-selected",(!0).toString())):(d.classList.remove(R),d.setAttribute("data-selected",(!1).toString()))}function k(a,b,f){var g=e(a,b);g&&g===c.unwrap(a.value)?(f.classList.add(R),f.setAttribute("data-selected",(!0).toString()),a.captionText.textContent=d(a,b)):(f.classList.remove(R),f.setAttribute("data-selected",(!1).toString()))}function l(a){switch(c.unwrap(a.selectedOptions).length){case 0:a.captionText.textContent=c.unwrap(a.optionsCaption);break;case 1:a.captionText.textContent=d(a,i(c.unwrap(a.options),c.unwrap(a.selectedOptions)[0],a));break;default:a.captionText.textContent=c.unwrap(a.selectedOptions).length+V}}function m(a){for(;a.containerDiv.firstChild;)a.containerDiv.removeChild(a.containerDiv.firstChild);if(a.maxIndex=c.unwrap(a.options).length-1,c.unwrap(a.options).length>0){var b;c.unwrap(a.options).forEach(function(c){b=h(c,a),a.containerDiv.appendChild(b),a.multiple?j(a,c,b):k(a,c,b)})}a.multiple&&l(a)}function n(a,b,d){var f,g;g=e(a,b),f=c.unwrap(a.selectedOptions).indexOf(g),f>=0?(a.selectedOptions.splice(f,1),d.classList.remove(R),d.setAttribute("data-selected",(!1).toString())):(a.selectedOptions.push(g),d.classList.add(R),d.setAttribute("data-selected",(!0).toString()))}function o(a,b,f){if(c.isObservable(a.value))a.value(e(a,b));else{a.value=e(a,b),a.captionText.textContent=d(a,b);for(var g=a.hoverIndex(),h=0;h<f.length;h++)h===g?(f[h].classList.add(R),f[h].setAttribute("data-selected",(!0).toString())):(f[h].classList.remove(R),f[h].setAttribute("data-selected",(!1).toString()))}}function p(a){if(a.multiple&&(void 0===a.options||void 0===a.selectedOptions))throw"with multiple set, options and selectedOptions binding must be valid for this dropDownSelect-binding to work";if(!a.multiple&&(void 0===a.options||void 0===a.value))throw"without multiple set, options and value binding must be valid for this dropDownSelect-binding to work";if(void 0!==a.optionsText&&"string"!=typeof a.optionsText&&"function"!=typeof a.optionsText)throw"if optionsText is set it must be a valid string describing a property name";if(void 0!==a.optionsValue&&"string"!=typeof a.optionsValue&&"function"!=typeof a.optionsValue)throw"if optionsValue is set it must be a valid string describing a property name";if(void 0!==a.optionsCaption&&"string"!=typeof a.optionsCaption&&!c.isObservable(a.optionsCaption))throw"if optionsCaption is set it must be a valid string";return void 0===a.optionsCaption&&(a.optionsCaption=U),!0}function q(a){return function(b){var c=b.target||b.srcElement;return a.hoverIndex(Array.prototype.indexOf.call(a.containerDiv.childNodes,c)),b.stopPropagation(),!0}}function r(a){return function(){a.maxIndex<0||(a.hoverIndex()<=0?a.hoverIndex(a.maxIndex):a.hoverIndex(a.hoverIndex()-1),a.hoverIndex()>=0&&a.containerDiv.childNodes[a.hoverIndex()].scrollIntoView(!1))}}function s(a){return function(){a.maxIndex<0||(a.showBox||(t(a)(void 0),a.hoverIndex(-1)),a.hoverIndex()>=a.maxIndex?a.hoverIndex(0):a.hoverIndex(a.hoverIndex()+1),a.hoverIndex()>=0&&a.containerDiv.childNodes[a.hoverIndex()].scrollIntoView(!1))}}function t(a){return function(b){6!==b.mozInputSource&&(a.showBox?(a.showBox=!1,a.inside=!1,a.captionElement.setAttribute("data-open",(!1).toString()),a.containerDiv.style.display="none"):(a.captionElement.focus(),a.captionElement.setAttribute("data-open",(!0).toString()),a.showBox=!0,f(a.containerDiv,a.captionElement),a.containerDiv.style.display="block",a.size=parseInt(a.element.getAttribute("size")),a.size?a.containerDiv.style.height=a.containerDiv.firstChild.getBoundingClientRect().height*a.size+"px":a.containerDiv.style.height="auto"))}}function u(a){return function(b){var c=b.toElement||b.relatedTarget;c.parentNode!==a.containerDiv&&c!==a.containerDiv&&(a.inside=!1)}}function v(a){return function(){a.inside=!0}}function w(a){return function(b){a.captionElement.focus();for(var c=a.containerDiv.childNodes,d=0;d<c.length;d++)d===b?c[d].classList.add(S):c[d].classList.remove(S)}}function x(a){return function(){a.inside?a.captionElement.focus():(a.showBox=!1,a.containerDiv.style.display="none",a.captionElement.setAttribute("data-open",(!1).toString()))}}function y(a){return function(){var b=a.hoverIndex();if(0>b||!a.showBox)return!1;var d=c.unwrap(c.unwrap(a.options)[b]),e=a.containerDiv.childNodes,f=e[b];return a.multiple?(n(a,d,f),l(a),a.captionElement.focus()):(o(a,d,e),a.inside=!1,x(a)()),!1}}function z(a){return function(b){switch(b=b||window.event,b.keyCode){case 38:return r(a)(),b.preventDefault(),!1;case 40:return s(a)(),b.preventDefault(),!1;case 27:return a.inside=!1,a.showBox=!1,x(a)(),!0;case 32:return y(a)(),b.stopPropagation(),b.preventDefault(),!1;default:return!0}}}function A(a){return function(){m(a)}}function B(a){return function(b){a.captionElement.disabled=!b}}function C(a){return function(b){a.captionElement.disabled=b}}function D(a){return function(b){var e=i(c.unwrap(a.options),c.unwrap(b),a);void 0===b?a.captionText.textContent=c.unwrap(a.optionsCaption):a.captionText.textContent=d(a,e);for(var f=a.containerDiv.childNodes,g=c.unwrap(a.options).indexOf(e),h=0;h<f.length;h++)b&&h===g?(f[h].classList.add(R),f[h].setAttribute("data-selected",(!0).toString())):(f[h].classList.remove(R),f[h].setAttribute("data-selected",(!1).toString()))}}function E(a){return function(){c.unwrap(a.options).forEach(function(b,c){j(a,b,a.containerDiv.childNodes[c])}),l(a)}}function F(a){return function(b){a.multiple&&0===c.unwrap(a.selectedOptions).length?a.captionText.textContent=b:a.multiple||void 0!==a.value||(a.captionText.textContent=b)}}function G(a){a.captionElement.onkeydown=z(a),a.captionElement.onclick=t(a),a.containerDiv.onmouseenter=v(a),a.captionElement.onblur=x(a),a.containerDiv.onmouseout=u(a)}function H(a){var b=a.element.parentNode,c=document.createElement("div");c.classList.add(M),g(a),b.replaceChild(c,a.element),a.containerDiv.style.display="none",c.style.position="relative",a.element.style.display="none",c.appendChild(a.element),c.appendChild(a.captionElement),c.appendChild(a.containerDiv)}function I(a){a.subscriptions.push(a.hoverIndex.subscribe(w(a))),c.isObservable(a.options)&&a.subscriptions.push(a.options.subscribe(A(a))),void 0!==a.enable&&(B(a)(c.unwrap(a.enable)),c.isObservable(a.enable)&&a.subscriptions.push(a.enable.subscribe(B(a)))),void 0!==a.disable&&(C(a)(c.unwrap(a.disable)),c.isObservable(a.disable)&&a.subscriptions.push(a.disable.subscribe(C(a)))),void 0===a.value||a.multiple||a.subscriptions.push(a.value.subscribe(D(a))),void 0!==a.selectedOptions&&a.multiple&&a.subscriptions.push(a.selectedOptions.subscribe(E(a))),c.isObservable(a.optionsCaption)&&a.subscriptions.push(a.optionsCaption.subscribe(F(a)))}function J(a){a.captionElement.onkeydown=null,a.captionElement.onclick=null,a.containerDiv.onmouseenter=null,a.captionElement.onblur=null,a.containerDiv.onmouseout=null}function K(a){J(a),a.dispose.call(a)}var L="knockout-select",M=L,N=L+"-button",O=L+"-container",P=L+"-arrow",Q=L+"-row",R=L+"-row-selected",S=L+"-row-active",T=9999,U="Choose...",V=" items selected",W=function(){function a(a,b,d){this.captionElement=void 0,this.containerDiv=document.createElement("div"),this.captionText=void 0,this.element=d,this.options=a(),this.selectedOptions=b().selectedOptions,this.value=b().cap3Value,this.enable=b().enable,this.disable=b().disable,this.optionsCaption=b().optionsCaption,this.optionsText=b().optionsText,this.optionsValue=b().optionsValue,this.multiple=d.hasAttribute("multiple"),this.size=parseInt(d.getAttribute("size")),this.hoverIndex=c.observable(-1),this.maxIndex=-1,this.inside=!1,this.showBox=!1,this.subscriptions=[]}return a.prototype.dispose=function(){if(this.captionElement=null,this.containerDiv=null,this.captionText=null,this.element=null,this.options=null,this.selectedOptions=null,this.value=null,this.enable=null,this.disable=null,this.optionsCaption=null,this.optionsText=null,this.optionsValue=null,this.multiple=null,this.hoverIndex=null,this.subscriptions){for(var a=0;a<this.subscriptions.length;a++)this.subscriptions[a].dispose();this.subscriptions=null}},a}(),X=function(){function a(a,b){this.x=a,this.y=b}return a}();a.Binding={init:function(a,b,d){var e=new W(b,d,a);p(e),H(e),G(e),I(e),m(e),f(e.containerDiv,e.captionElement),c.utils.domNodeDisposal.addDisposeCallback(a,function(){K(e),e=void 0})}}}(d||(d={})),c.bindingHandlers.cap3Options=d.Binding});