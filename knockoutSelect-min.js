"use strict";!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(window.ko)}(function(a){function b(b,c,d){function e(){if(this.captionElement=null,this.containerDiv=null,this.captionText=null,this.element=null,this.options=null,this.selectedOptions=null,this.value=null,this.enable=null,this.disable=null,this.optionsCaption=null,this.optionsText=null,this.optionsValue=null,this.multiple=null,this.hoverIndex=null,this.subscriptions){for(var a=0;a<this.subscriptions.length;a++)this.subscriptions[a].dispose();this.subscriptions=null}}this.captionElement=void 0,this.containerDiv=document.createElement("div"),this.captionText=void 0,this.element=d,this.options=b(),this.selectedOptions=c().selectedOptions,this.value=c().cap3Value,this.enable=c().enable,this.disable=c().disable,this.optionsCaption=c().optionsCaption,this.optionsText=c().optionsText,this.optionsValue=c().optionsValue,this.multiple=d.hasAttribute("multiple"),this.size=parseInt(d.getAttribute("size")),this.hoverIndex=a.observable(-1),this.maxIndex=-1,this.inside=!1,this.showBox=!1,this.subscriptions=[],this.dispose=e}function c(a,b){this.x=a,this.y=b}function d(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function e(b,c){return c&&b.optionsText&&"string"==typeof b.optionsText?a.unwrap(a.unwrap(c)[b.optionsText]):b.optionsText&&"function"==typeof b.optionsText?b.optionsText(a.unwrap(a.unwrap(c))):a.unwrap(c)}function f(b,c){return b.optionsValue&&"string"==typeof b.optionsValue?a.unwrap(a.unwrap(c)[b.optionsValue]):b.optionsValue&&"function"==typeof b.optionsValue?b.optionsValue(a.unwrap(a.unwrap(c))):a.unwrap(c)}function g(a,b){b.classList.add(N),b.classList.add(O),a.classList.add(N),a.classList.add(P),a.style.minWidth=b.offsetWidth+"px",a.style.width="auto",a.style.position="absolute",a.style.overflow="auto",a.style.zIndex=U}function h(b){b.captionElement=document.createElement("button"),b.captionText=document.createElement("span"),b.captionElement.appendChild(b.captionText);var c=document.createElement("span");c.classList.add(Q),b.captionElement.appendChild(c),b.captionText.textContent=a.unwrap(b.optionsCaption),b.captionElement.setAttribute("data-open",!1),b.element.getAttribute("tabindex")&&(b.captionElement.setAttribute("tabindex",b.element.getAttribute("tabindex")),b.element.removeAttribute("tabindex"))}function i(a,b){var f=document.createElement("div");f.textContent=e(b,a),f.setAttribute("data-selected","false"),f.classList.add(R),f.onmouseover=r(b),f.onclick=z(b);var g=-1,h=new c(-1,-1);return f.ontouchstart=function(a){return 1===a.touches.length?(h.x=a.touches[0].pageX,h.y=a.touches[0].pageY,g=a.timeStamp||(new Date).getTime(),a.stopPropagation(),r(b)(a)):(b.hoverIndex(-1),!0)},f.ontouchend=function(a){if(0===a.touches.length&&1===a.changedTouches.length){var e=new c(a.changedTouches[0].pageX,a.changedTouches[0].pageY),f=d(h,e),i=a.timeStamp||(new Date).getTime();if(1e3>i-g&&10>f)return a.stopPropagation(),z(b)()}return b.hoverIndex(-1),!0},f}function j(b,c,d){for(var e=0;e<b.length;e++)if(f(d,b[e])===a.unwrap(c))return b[e];return void 0}function k(b,c,d){a.unwrap(b.selectedOptions).indexOf(f(b,c))>=0?(d.classList.add(S),d.setAttribute("data-selected",!0)):(d.classList.remove(S),d.setAttribute("data-selected",!1))}function l(b,c,d){var g=f(b,c);g&&g===a.unwrap(b.value)?(d.classList.add(S),d.setAttribute("data-selected",!0),b.captionText.textContent=e(b,c)):(d.classList.remove(S),d.setAttribute("data-selected",!1))}function m(b){switch(a.unwrap(b.selectedOptions).length){case 0:b.captionText.textContent=a.unwrap(b.optionsCaption);break;case 1:b.captionText.textContent=e(b,j(a.unwrap(b.options),a.unwrap(b.selectedOptions)[0],b));break;default:b.captionText.textContent=a.unwrap(b.selectedOptions).length+W}}function n(b){for(;b.containerDiv.firstChild;)b.containerDiv.removeChild(b.containerDiv.firstChild);if(b.maxIndex=a.unwrap(b.options).length-1,a.unwrap(b.options).length>0){var c;a.unwrap(b.options).forEach(function(a){c=i(a,b),b.containerDiv.appendChild(c),b.multiple?k(b,a,c):l(b,a,c)})}b.multiple&&m(b)}function o(b,c,d){var e,g;g=f(b,c),e=a.unwrap(b.selectedOptions).indexOf(g),e>=0?(b.selectedOptions.splice(e,1),d.classList.remove(S),d.setAttribute("data-selected",!1)):(b.selectedOptions.push(g),d.classList.add(S),d.setAttribute("data-selected",!0))}function p(b,c,d){if(a.isObservable(b.value))b.value(f(b,c));else{b.value=f(b,c),b.captionText.textContent=e(b,c);for(var g=b.hoverIndex(),h=0;h<d.length;h++)h===g?(d[h].classList.add(S),d[h].setAttribute("data-selected",!0)):(d[h].classList.remove(S),d[h].setAttribute("data-selected",!1))}}function q(b){if(b.multiple&&(void 0===b.options||void 0===b.selectedOptions))throw"with multiple set, options and selectedOptions binding must be valid for this dropDownSelect-binding to work";if(!b.multiple&&(void 0===b.options||void 0===b.value))throw"without multiple set, options and value binding must be valid for this dropDownSelect-binding to work";if(void 0!==b.optionsText&&"string"!=typeof b.optionsText&&"function"!=typeof b.optionsText)throw"if optionsText is set it must be a valid string describing a property name";if(void 0!==b.optionsValue&&"string"!=typeof b.optionsValue&&"function"!=typeof b.optionsValue)throw"if optionsValue is set it must be a valid string describing a property name";if(void 0!==b.optionsCaption&&"string"!=typeof b.optionsCaption&&!a.isObservable(b.optionsCaption))throw"if optionsCaption is set it must be a valid string";return void 0===b.optionsCaption&&(b.optionsCaption=V),!0}function r(a){return function(b){var c=b.target||b.srcElement;return a.hoverIndex(Array.prototype.indexOf.call(a.containerDiv.childNodes,c)),b.stopPropagation(),!0}}function s(a){return function(){a.maxIndex<0||(a.hoverIndex()<=0?a.hoverIndex(a.maxIndex):a.hoverIndex(a.hoverIndex()-1),a.hoverIndex()>=0&&a.containerDiv.childNodes[a.hoverIndex()].scrollIntoView(!1))}}function t(a){return function(){a.maxIndex<0||(a.showBox||(u(a)(!0),a.hoverIndex(-1)),a.hoverIndex()>=a.maxIndex?a.hoverIndex(0):a.hoverIndex(a.hoverIndex()+1),a.hoverIndex()>=0&&a.containerDiv.childNodes[a.hoverIndex()].scrollIntoView(!1))}}function u(a){return function(b){6!==b.mozInputSource&&(a.showBox?(a.showBox=!1,a.inside=!1,a.captionElement.setAttribute("data-open",!1),a.containerDiv.style.display="none"):(a.captionElement.focus(),a.captionElement.setAttribute("data-open",!0),a.showBox=!0,g(a.containerDiv,a.captionElement),a.containerDiv.style.display="block",a.size=parseInt(a.element.getAttribute("size")),a.size?a.containerDiv.style.height=a.containerDiv.firstChild.getBoundingClientRect().height*a.size+"px":a.containerDiv.style.height="auto"))}}function v(a){return function(b){var c=b.toElement||b.relatedTarget;c.parentNode!==a.containerDiv&&c!==a.containerDiv&&(a.inside=!1)}}function w(a){return function(){a.inside=!0}}function x(a){return function(b){a.captionElement.focus();for(var c=a.containerDiv.childNodes,d=0;d<c.length;d++)d===b?c[d].classList.add(T):c[d].classList.remove(T)}}function y(a){return function(){a.inside?a.captionElement.focus():(a.showBox=!1,a.containerDiv.style.display="none",a.captionElement.setAttribute("data-open",!1))}}function z(b){return function(){var c=b.hoverIndex();if(0>c||!b.showBox)return!1;var d=a.unwrap(a.unwrap(b.options)[c]),e=b.containerDiv.childNodes,f=e[c];return b.multiple?(o(b,d,f),m(b),b.captionElement.focus()):(p(b,d,e),b.inside=!1,y(b)()),!1}}function A(a){return function(b){switch(b=b||window.event,b.keyCode){case 38:return s(a)(),b.preventDefault(),!1;case 40:return t(a)(),b.preventDefault(),!1;case 27:return a.inside=!1,a.showBox=!1,y(a)(),!0;case 32:return z(a)(),b.stopPropagation(),b.preventDefault(),!1;default:return!0}}}function B(a){return function(){n(a)}}function C(a){return function(b){a.captionElement.disabled=!b}}function D(a){return function(b){a.captionElement.disabled=b}}function E(b){return function(c){var d=j(a.unwrap(b.options),a.unwrap(c),b);void 0===c?b.captionText.textContent=a.unwrap(b.optionsCaption):b.captionText.textContent=e(b,d);for(var f=b.containerDiv.childNodes,g=a.unwrap(b.options).indexOf(d),h=0;h<f.length;h++)c&&h===g?(f[h].classList.add(S),f[h].setAttribute("data-selected",!0)):(f[h].classList.remove(S),f[h].setAttribute("data-selected",!1))}}function F(b){return function(){a.unwrap(b.options).forEach(function(a,c){k(b,a,b.containerDiv.childNodes[c])}),m(b)}}function G(a){return function(b){a.multiple&&0===a.selectedOptions().length?a.captionText.textContent=b:a.multiple||void 0!==a.value||(a.captionText.textContent=b)}}function H(a){a.captionElement.onkeydown=A(a),a.captionElement.onclick=u(a),a.containerDiv.onmouseenter=w(a),a.captionElement.onblur=y(a),a.containerDiv.onmouseout=v(a)}function I(a){var b=a.element.parentNode,c=document.createElement("div");c.classList.add(N),h(a),b.replaceChild(c,a.element),a.containerDiv.style.display="none",c.style.position="relative",a.element.style.display="none",c.appendChild(a.element),c.appendChild(a.captionElement),c.appendChild(a.containerDiv)}function J(b){b.subscriptions.push(b.hoverIndex.subscribe(x(b))),a.isObservable(b.options)&&b.subscriptions.push(b.options.subscribe(B(b))),void 0!==b.enable&&(C(b)(b.enable),a.isObservable(b.enable)&&b.subscriptions.push(b.enable.subscribe(C(b)))),void 0!==b.disable&&(D(b)(b.disable),a.isObservable(b.disable)&&b.subscriptions.push(b.disable.subscribe(D(b)))),void 0===b.value||b.multiple||b.subscriptions.push(b.value.subscribe(E(b))),void 0!==b.selectedOptions&&b.multiple&&b.subscriptions.push(b.selectedOptions.subscribe(F(b))),a.isObservable(b.optionsCaption)&&b.subscriptions.push(b.optionsCaption.subscribe(G(b)))}function K(a){a.captionElement.onkeydown=null,a.captionElement.onclick=null,a.containerDiv.onmouseenter=null,a.captionElement.onblur=null,a.containerDiv.onmouseout=null}function L(a){K(a),a.dispose.call(a)}var M="knockout-select",N=M,O=M+"-button",P=M+"-container",Q=M+"-arrow",R=M+"-row",S=M+"-row-selected",T=M+"-row-active",U=9999,V="Choose...",W=" items selected";a.bindingHandlers.cap3Options={init:function(c,d,e){var f=new b(d,e,c);q(f),I(f),H(f),J(f),n(f),g(f.containerDiv,f.captionElement),a.utils.domNodeDisposal.addDisposeCallback(c,function(){L(f),f=void 0})}}});